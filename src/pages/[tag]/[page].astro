---
import BlogItem from '@components/BlogItem.astro';
import Heading from '@components/Heading';
import LinkButton from '@components/LinkButton';
import MainLayout from '@layouts/MainLayout.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths({ paginate }: any) {
  const posts = await getCollection('blog');
  const sortedPosts = posts.sort((a, b) => {
    return Date.parse(b.data.date) - Date.parse(a.data.date);
  });

  let allTags: string[] = [];
  posts.forEach((post) => {
    const tagsInPost = post.data.tags;
    allTags = [...allTags, ...tagsInPost];
  });

  const filteredAllTags = [...new Set(allTags)];

  return filteredAllTags.map((tag) => {
    const filteredPosts = sortedPosts.filter((post) => {
      return post.data.tags.includes(tag);
    });
    const tagForSlug = tag.toLowerCase().replace('.', '-');
    return paginate(filteredPosts, {
      params: { tag: tagForSlug },
      pageSize: 6,
    });
  });
}
const { page } = Astro.props;
const params = Astro.params;

const tagNameForUI = page.data[0].data.tags.filter(
  (tag: string) => tag.toLowerCase().replace('.', '-') === params.tag
);
---

<MainLayout title="Blogs" description={`${tagNameForUI[0]}„Å´Èñ¢„Åô„ÇãË®ò‰∫ã‰∏ÄË¶ß`}>
  <Heading title="Êîπ‰øÆ‰∏≠üíÅ‚Äç‚ôÇÔ∏è" />
  <!-- <Heading title={tagNameForUI[0] || 'ü§°'} subTitle="„Å´Èñ¢„Åô„ÇãË®ò‰∫ã‰∏ÄË¶ß" />
  <div class="mt-5 lg:mt-10">
    <div class="divide-y divide-primary dark:divide-soft-white">
      {
        page.data.map((post: any) => {
          return <BlogItem key={post.frontmatter.url} post={post} />;
        })
      }
    </div>
    <div class="mt-10 space-y-6">
      <div class="flex justify-center items-center gap-x-5 md:gap-x-8">
        <LinkButton href={page.url.prev} disabled={!page.url.prev}>
          Êñ∞„Åó„ÅÑË®ò‰∫ã„Å∏
        </LinkButton>
        <LinkButton href={page.url.next} disabled={!page.url.next}>
          Âè§„ÅÑË®ò‰∫ã„Å∏
        </LinkButton>
      </div>
    </div>
  </div> -->
</MainLayout>
